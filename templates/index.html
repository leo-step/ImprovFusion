<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" type="image/x-icon" href="/Favicon.ico">

    <title>ImprovFusion</title>
        <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- Plugin CSS -->
    <link href="vendor/magnific-popup/magnific-popup.css" rel="stylesheet" type="text/css">

    <!-- Custom styles for this template -->
    <link href="css/freelancer.css" rel="stylesheet">

  </head>

  <body id="page-top">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg bg-secondary fixed-top text-uppercase" id="mainNav">
      <div class="container">
        <!-- <a class="navbar-brand js-scroll-trigger" href="#page-top">ImprovFusion</a> -->
        <button class="navbar-toggler navbar-toggler-right text-uppercase text-white rounded" id="menu" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <!-- <h5>Menu</h5> -->
          <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item mx-0 mx-lg-1">
              <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#about">About</a>
            </li>
            <li class="nav-item mx-0 mx-lg-1">
              <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#portfolio">Samples</a>
            </li>
            <li class="nav-item mx-0 mx-lg-1">
              <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#try">Try</a>
            </li>
            <!--
            <li class="nav-item mx-0 mx-lg-1">
              <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#contact">Contact</a>
            </li>
            -->
            <li>
                <a class="btn btn-outline-light btn-social text-center rounded-circle" href="https://github.com/leo-step/ImprovFusion">
                    <i class="fab fa-fw fa-github"></i>
                </a>
            </li>
            <li>
                <a class="btn btn-outline-light btn-social text-center rounded-circle" href="https://www.linkedin.com/in/leo-stepanewk/">
                  <i class="fab fa-fw fa-linkedin-in"></i>
                </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Header -->
    <header class="masthead bg-primary text-white text-center">
      <div class="container">
        <img class="img-fluid mb-5 d-block mx-auto" src="img/logo.png" alt="ImprovFusion">
        <hr class="star-dark mb-5">
        <h2 class="text-secondary mb-0">Markov Chain Music Generation Project</h2>
        <br>
        <h5 class="text-secondary mb-0">Created by Leo Stepanewk</h5>
      </div>
    </header>

    <!-- About Section -->
    <section class="bg-primary text-secondary mb-0" id="about">
      <div class="container">
        <h2 class="text-center text-uppercase text-secondary">About</h2>
        <hr class="star-dark mb-5">
        <div class="row">
          <div class="col-lg-4 ml-auto">
            <p class="lead">The project applies the concepts found in natural language generation and Markov chains to generate an improvised version of a musical arrangement.</p>
          </div>
          <div class="col-lg-4 mr-auto">
            <p class="lead">The application is capable of generating an improvisation of any length and similarity to the original piece while providing an interactive visualization of note transition pathways.</p>
          </div>
        </div>

      </div>
    </section>

    <!-- Portfolio Grid Section -->
    <section class="portfolio" id="portfolio">
      <div class="container" style="text-align: center">
        <h2 class="text-center text-uppercase text-secondary mb-0">Samples</h2>
        <hr class="star-dark mb-5">
        <h3 class="text-center text-secondary mb-0">Fur Elise by Beethoven</h3>
         <div class="row">
             <div class="col">
                <h4 class="text-secondary mb-0">Original</h4>
                <audio controls>
                <source src="/audio/furelise.mp3" type="audio/mpeg">
            Your browser does not support the audio element.
            </audio>
            </div>
            <div class="col">
                <h4 class="text-secondary mb-0">Improvised</h4>
            <audio controls>
                <source src="/audio/eliseimprov.mp3" type="audio/mpeg">
            Your browser does not support the audio element.
            </audio>
            </div>
         </div>




      <div id="force_parent">
          <h4 class="text-center text-secondary mb-0">Interactive Probability Graph</h4>
          <br>
            <!-- JavaScript Libraries //-->
<script src="https://d3js.org/d3.v3.min.js"></script>

<!-- CSS Style //-->
<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,900|Source+Code+Pro:300" rel="stylesheet" type="text/css">
<link href="style.css" rel="stylesheet" type="text/css">

<script>
var width  = 1000;
var height = 500;
var margin = 20;
var pad = margin / 2;


//var  color1 = d3.scale.category10();

var  color1 = d3.scale.ordinal().domain(['1','2','3','4','5','6','7','8','9','10']).range(['#5A0001','#2F6690','#ED254E','#E3B23C','#861388','#E2856E','#074F57','#7A28CB','#1B9AAA','#CB958E']);


// Generates a tooltip for a SVG circle element based on its ID
function addTooltip(circle) {
    var x = parseFloat(circle.attr("cx"));
    var y = parseFloat(circle.attr("cy"));
    var r = parseFloat(circle.attr("r"));
    var text = circle.attr("lb");

    var tooltip = d3.select("#plot")
        .append("text")
        .text(text)
        .attr("x", x)
        .attr("y", y)
        .attr("dy", -r * 2)
        .attr("id", "tooltip");

    var offset = tooltip.node().getBBox().width / 2;

    if ((x - offset) < 0) {
        tooltip.attr("text-anchor", "start");
        tooltip.attr("dx", -r);
    }
    else if ((x + offset) > (width - margin)) {
        tooltip.attr("text-anchor", "end");
        tooltip.attr("dx", r);
    }
    else {
        tooltip.attr("text-anchor", "middle");
        tooltip.attr("dx", 0);
    }
}
var vis = d3.select("#chart")
  .append("svg:svg")
    .attr("width", width)
    .attr("height", height)
    .attr("pointer-events", "all")
  .append('svg:g')
    .call(d3.behavior.zoom().on("zoom", redraw))
  .append('svg:g');

vis.append('svg:rect')
    .attr('width', width)
    .attr('height', height)
    .attr('fill', 'white');

function redraw() {
  console.log("here", d3.event.translate, d3.event.scale);
  vis.attr("transform",
      "translate(" + d3.event.translate + ")"
      + " scale(" + d3.event.scale + ")");
}

function drawGraph(graph) {
    var svg = d3.select("#force").append("svg")
        .attr("width", width)
        .attr("height", height);

    // draw plot background
    svg.append("rect")
        .attr("width", width)
        .attr("height", height)
        .style("fill", "#ffffff");

    // create an area within svg for plotting graph
    var plot = svg.append("g")
        .attr("id", "plot")
        .attr("transform", "translate(" + pad + ", " + pad + ")");

    // https://github.com/mbostock/d3/wiki/Force-Layout#wiki-force
    var layout = d3.layout.force()
        .size([width - margin, height - margin])
        .charge(-400)
        .linkDistance(function(d, i) {
            return (d.source.group == d.target.group) ? 50 : 100;
        })
        .nodes(graph.nodes)
        .links(graph.links)
        .start();

    drawLinks(graph.links);
    drawNodes(graph.nodes);

    // add ability to drag and update layout
    // https://github.com/mbostock/d3/wiki/Force-Layout#wiki-drag
    d3.selectAll(".node").call(layout.drag);

    // https://github.com/mbostock/d3/wiki/Force-Layout#wiki-on
    layout.on("tick", function() {
        d3.selectAll(".link")
            .attr("x1", function(d) { return d.source.x; })
            .attr("y1", function(d) { return d.source.y; })
            .attr("x2", function(d) { return d.target.x; })
            .attr("y2", function(d) { return d.target.y; });

        d3.selectAll(".node")
            .attr("cx", function(d) { return d.x; })
            .attr("cy", function(d) { return d.y; });
    });
}
    function tick(e) {
  // Push different nodes in different directions for clustering.
  var k = 6 * e.alpha;
  graph.nodes.forEach(function(o, i) {
    o.y += i & 1 ? k : -k;
    o.x += i & 2 ? k : -k;
  });
  node.attr("cx", function(d) { return d.x; })
      .attr("cy", function(d) { return d.y; });

}
// Draws nodes on plot
function drawNodes(nodes) {
    // used to assign nodes color by group
    var color = color1;//d3.scale.category10();

    // https://github.com/mbostock/d3/wiki/Force-Layout#wiki-nodes
    d3.select("#plot").selectAll(".node")
        .data(nodes)
        .enter()
        .append("circle")
        .attr("class", "node")
        .attr("id", function(d, i) { return d.name; })
        .attr("lb", function(d, i) { return d.label; })
        .attr("cx", function(d, i) { return d.x; })
        .attr("cy", function(d, i) { return d.y; })
        .attr("r",  function(d, i) { return Math.sqrt(d.size)*2; })
        .style("fill",   function(d, i) { return color(d.group); })
        .on("mouseover", function(d, i) { addTooltip(d3.select(this)); })
        .on("mouseout",  function(d, i) { d3.select("#tooltip").remove(); });
}

// Draws edges between nodes
function drawLinks(links) {
    var scale = d3.scale.linear()
        .domain(d3.extent(links, function(d, i) {
           return d.value;
        }))
        .range([1, 6]);

    // https://github.com/mbostock/d3/wiki/Force-Layout#wiki-links
    d3.select("#plot").selectAll(".link")
        .data(links)
        .enter()
        .append("line")
        .attr("class", "link")
        .attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; })
        .style("stroke-width", function(d, i) {
            return scale(d.value*2) + "px";
        })
        .style("stroke-dasharray", function(d, i) {
            return (d.value <= 1) ? "2, 2" : "none";
        });

}

</script>
<script src="js/toastr.min.js"></script>
<link href="css/toastr.css" rel="stylesheet" type="text/css">
<script>
    function click_upload() {
        document.getElementById('input-file').click();
    }
    function click_download() {
        document.getElementById('download_button').setAttribute("onclick", "click_download_before_upload()");
        toastr.options = {
          "closeButton": true,
          "debug": false,
          "newestOnTop": false,
          "progressBar": false,
          "positionClass": "toast-bottom-right",
          "preventDuplicates": true,
          "onclick": null,
          "showDuration": "1500",
          "hideDuration": "1000",
          "timeOut": "5000",
          "extendedTimeOut": "1000",
          "showEasing": "swing",
          "hideEasing": "linear",
          "showMethod": "fadeIn",
          "hideMethod": "fadeOut"
        }
        toastr["info"]("Please WAIT for improvisation file download!", "Information")
        document.getElementById('submitbutton').click();

        document.getElementById('content-target').value = '';
    }
    function click_download_before_upload() {
        //alert("Please upload MusicXML file!")
        toastr.options = {
          "closeButton": true,
          "debug": false,
          "newestOnTop": false,
          "progressBar": false,
          "positionClass": "toast-bottom-right",
          "preventDuplicates": true,
          "onclick": null,
          "showDuration": "1500",
          "hideDuration": "1000",
          "timeOut": "5000",
          "extendedTimeOut": "1000",
          "showEasing": "swing",
          "hideEasing": "linear",
          "showMethod": "fadeIn",
          "hideMethod": "fadeOut"
        }
        toastr["warning"]("Please upload MusicXML file!", "Warning")


    }
</script>

<div align="center" id="force"></div>

<link href="upload.css" rel="stylesheet"/>
<script src="vendor/jquery/jquery.min.js"></script>

<section class="bg-primary text-secondary mb-0" id="try">
      <div class="container">
        <h2 class="text-center text-uppercase text-secondary">Try It</h2>
        <hr class="star-dark mb-5">
        <form name="TryIt" id="TryItForm" novalidate="novalidate">
        <div class="text-center mt-4">
            <div class="row">
            <div class="col-lg-3"></div>
            <div class="col-lg-3">
          <a class="form-group btn btn-xl btn-outline-dark text-white btn-primary btn-block" onclick="click_upload()" id="upload_button">
            <i class="fas fa-upload mr-2"></i>
            Upload MusicXML
          </a>
          <br>
          <div class="form-group floating-label-form-group controls mb-0 pb-2">
              <input class="form-control" id="length" type="text" placeholder="Length" aria-invalid="false">
                 <p class="help-block text-danger"></p>
          </div>
          </div>
          <div class="col-lg-3" >
          <a class="form-group btn btn-xl btn-outline-dark text-white btn-primary btn-block" id="download_button" onclick="click_download_before_upload()"> <!--onclick="click_download()" -->
            <i class="fas fa-download mr-2"></i>
            Improvise!
          </a>
          <br>
          <div class="form-group floating-label-form-group controls mb-0 pb-2">
              <input class="form-control" id="param" type="text" placeholder="Similarity(0-12)" aria-invalid="false" required="required" data-validation-required-message="Please enter a similarity 0 - 12.">
                 <p class="help-block text-danger"></p>
          </div>
          </div>
            </div>
        </div>
        </form>
      </div>
    </section>


<div style="display:none">
 <input type="file" id="input-file" multiple>
 <input type="button" id="submitbutton" onclick="submit(null)">Submit</input>
 <a id="download_link" href="" style="display:none"></a> -->
</div>

<textarea id="content-target" style="display:none"></textarea>

<script>
function b64toBlob(b64Data, contentType, sliceSize) {
  contentType = contentType || '';
  sliceSize = sliceSize || 512;

  var byteCharacters = atob(b64Data);
  var byteArrays = [];

  for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {
    var slice = byteCharacters.slice(offset, offset + sliceSize);

    var byteNumbers = new Array(slice.length);
    for (var i = 0; i < slice.length; i++) {
      byteNumbers[i] = slice.charCodeAt(i);
    }

    var byteArray = new Uint8Array(byteNumbers);

    byteArrays.push(byteArray);
  }

  var blob = new Blob(byteArrays, {type: contentType});
  return blob;
}

function submit(event) {
    //alert('submit');
    document.getElementById("download_button").disabled = true;
    var content = $("textarea#content-target").val();
    var param = $("#param").val();
    var length = $("input#length").val();
$.ajax({
    url: "/",
    type: "POST",
    data: {
      content: content,
      param: param,
      length: length
    },
    cache: false,
    success: function(data){
      var blob =  b64toBlob(data, {type: 'text/xml'});
        a = document.getElementById('download_link'),
        a.href = window.URL.createObjectURL(blob);
        // Give filename you wish to download
        a.download = "output.xml";
        document.body.appendChild(a);
        a.click();
    },
    error: function() {
         //alert("Error")
             toastr.options = {
      "closeButton": true,
      "debug": false,
      "newestOnTop": false,
      "progressBar": false,
      "positionClass": "toast-bottom-right",
      "preventDuplicates": true,
      "onclick": null,
      "showDuration": "1500",
      "hideDuration": "1000",
      "timeOut": "5000",
      "extendedTimeOut": "1000",
      "showEasing": "swing",
      "hideEasing": "linear",
      "showMethod": "fadeIn",
      "hideMethod": "fadeOut"
        }
    toastr["error"]("Something went wrong...", "Error")

    }
});
}
    document.getElementById('input-file')
  .addEventListener('change', getFile)

function getFile_bkp(event) {
	const input = event.target
  if ('files' in input && input.files.length > 0) {
	  placeFileContent(
      document.getElementById('content-target'),
      input.files[0])
  }
}

function getFile(event) {
    const input = event.target
    filescount = input.files.length;
    filescount2 = filescount;
    //alert('init'+filescount2);
    if ('files' in input && filescount > 0) {
        for (var i = 0; i < filescount; i++) {
            placeFileContent(document.getElementById('content-target'), input.files[i])
        }

  }
}

function placeFileContent_bkp(target, file) {

	readFileContent(file).then(content => {
  	target.value = btoa(content)
  	if (!document.getElementById('content-target').value=='') {
            document.getElementById('download_button').setAttribute("onclick", "click_download()");
    }

  }).catch(error => console.log(error))
    	document.getElementById("submitbutton").disabled = false;
    	document.getElementById("download_button").disabled = false;
}

function placeFileContent(target, file) {

    readFileContent(file).then(content => {
        if (target.value == '') {
            target.value = content;
        } else {
            target.value = target.value + '-------------------------' + content;
        }
        filescount2--;
        //alert('down'+filescount2);
        if (filescount2 == 0) {

            if (!document.getElementById('content-target').value == '') {
                document.getElementById('download_button').setAttribute("onclick", "click_download()");
                target.value = btoa(target.value);
                document.getElementById("submitbutton").disabled = false;
                document.getElementById("download_button").disabled = false;
            }
        }
  }).catch(error => console.log(error))

}

function readFileContent(file) {
    document.getElementById("submitbutton").disabled = true;
    document.getElementById("download_button").disabled = true;//download_button
	const reader = new FileReader()
  return new Promise((resolve, reject) => {
    reader.onload = event => resolve(event.target.result)
    reader.onerror = error => reject(error)
    reader.readAsText(file)
  })
}
</script>

<script>
/*d3.json("ong-prod-cb-im-wordpress.db.json", drawGraph);*/
d3.json("furelise.json", drawGraph);
/*d3.json("network.json", drawGraph);*/
</script>
</div>
</div>
</section>

    <!-- Contact Section -->
    <!--
    <section id="contact">
      <div class="container">
        <h2 class="text-center text-uppercase text-secondary mb-0">Contact Me</h2>
        <hr class="star-dark mb-5">
        <div class="row">
          <div class="col-lg-8 mx-auto">
            <form name="sentMessage" id="contactForm" novalidate="novalidate">
              <div class="control-group">
                <div class="form-group floating-label-form-group controls mb-0 pb-2">
                  <label>Name</label>
                  <input class="form-control" id="name" type="text" placeholder="Name" required="required" data-validation-required-message="Please enter your name.">
                  <p class="help-block text-danger"></p>
                </div>
              </div>
              <div class="control-group">
                <div class="form-group floating-label-form-group controls mb-0 pb-2">
                  <label>Email Address</label>
                  <input class="form-control" id="email" type="email" placeholder="Email Address" required="required" data-validation-required-message="Please enter your email address.">
                  <p class="help-block text-danger"></p>
                </div>
              </div>
              <div class="control-group">
                <div class="form-group floating-label-form-group controls mb-0 pb-2">
                  <label>Message</label>
                  <textarea class="form-control" id="message" rows="5" placeholder="Message" required="required" data-validation-required-message="Please enter a message."></textarea>
                  <p class="help-block text-danger"></p>
                </div>
              </div>
              <br>
              <div id="success"></div>
              <div class="form-group">
                <button type="submit" class="btn btn-primary btn-xl" id="sendMessageButton" href='/send'>Send</button>
              </div>
              <div class="checkbox">
                <input type="checkbox" id="check">
                <label for="check" class="text-white">I am not a robot.</label>
                </div>
            </form>
          </div>
        </div>
      </div>
    </section>
    -->

    <div class="copyright py-4 text-center text-white">
      <div class="container">
        
                <a class="btn btn-outline-light btn-social text-center rounded-circle" href="https://github.com/leo-step/ImprovFusion">
                  <i class="fab fa-fw fa-github"></i>
                </a>

                <a class="btn btn-outline-light btn-social text-center rounded-circle" href="https://www.linkedin.com/in/leo-stepanewk/">
                  <i class="fab fa-fw fa-linkedin-in"></i>
                </a>
        
      </div>
    </div>
    

    <!-- Footer -->
    <footer class="footer text-center">
      <div class="container">
        <div class="row">
          <div class="col-md-4 mb-5 mb-lg-0">
          </div>
          <div class="col-md-4 mb-5 mb-lg-0">
              <!--<small>Copyright &copy; ImprovFusion 2018</small>-->
          </div>
          <div class="col-md-4">
              <!--<small>Project Founder: Leo Stepanewk</small>-->
          </div>
        </div>
      </div>
    </footer>


    <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
    <div class="scroll-to-top d-lg-none position-fixed ">
      <a class="js-scroll-trigger d-block text-center text-white rounded" href="#page-top">
        <i class="fa fa-chevron-up"></i>
      </a>
    </div>

    <script type="text/javascript">



  function resize() {

    if (window.innerWidth < width) {

    document.getElementById('force_parent').style.display = 'none';

  }
    else {
        document.getElementById('force_parent').style.display = 'block';

    }
  }

  window.onresize = resize;
  resize();
  </script>

<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
    <script src="vendor/magnific-popup/jquery.magnific-popup.min.js"></script>

    <!-- Contact Form JavaScript -->
    <script src="js/jqBootstrapValidation.js"></script>
    <script src="js/contact_me.js"></script>

    <!-- Custom scripts for this template -->
    <script src="js/freelancer.min.js"></script>

  </body>

</html>
